{% extends "layout.html" %}

{% block title %}
Data Mark
{% endblock %}

{% block stylesheets %}
<style type="text/css">
.mode-bar {
    text-align: right;
}
.mode-bar .mode-item {
    display: inline-block;
    min-width: 60px;
    height: 30px;
    line-height: 30px;
    text-align: center;
    border-radius: 5px;
    background-color: #eeeeee;
    margin-left: 10px;
    user-select: none;
    padding: 0 10px;
}
.mode-bar .mode-item.active {
    background-color: #00ff33;
}

.image-wrapper {
    width: 100%;
    height: 600px;
    overflow: hidden;
    background-color: black;
    position: relative;
    user-select: none;
}
.image-wrapper.zooming {
    cursor: move;
}
.image-wrapper.marking.mark_select {
    cursor: default;
}
.image-wrapper.marking.mark_place {
    cursor: none;
}
.image-wrapper img,
.image-wrapper .framebox {
    position: absolute;
    user-select: none;
}
</style>
{% endblock %}

{% block main %}
{% include "authbar.html" %}
{% verbatim %}
<div class="row" style="margin-top: 20px">
    <div class="col-md-2">
        <span>Dataset: </span>
        <b>{{ setname }}</b>
    </div>
    <div class="col-md-8">
        <div class="progress">
            <div class="progress-bar" role="progressbar" v-bind:style="{width: percent(statistics.marked, statistics.total)}">
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <span>
            <span>{{ statistics.marked }}</span>
            <span>of</span>
            <span>{{ statistics.total }}</span>
            <span>marked</span>
        </span>
    </div>
</div>
<div class="row" style="margin-top: 20px">
    <div class="col-md-6">
        <span>{{ sample.title }}</span>
    </div>
    <div class="col-md-6">
        <div class="mode-bar">
            <span class="mode-item">Zooming (Z)</span>
            <span class="mode-item">Marking (X)</span>
        </div>
    </div>
</div>
<div class="row" style="margin-top: 20px">
    <div class="col-md-12">
        <div class="image-wrapper" v-bind:class="viewerClasses">
            <img v-bind:src="sample.image.src">
        </div>
    </div>
</div>
{% endverbatim %}
{% endblock %}

{% block scripts %}
<script type="text/javascript">
var vue = new Vue({
    el: "#app",
    data: {
        setname: undefined,
        statistics: {
            marked: 0,
            total: 0
        },
        sample: {
            title: "G7 / 2018-08-28 20",
            image: (function (src) { var img = new Image(); img.src = src; return img })("/static/runtime/sample.jpg")
        },
        viewer: {
            mode: "zooming",
            pressed: false,
            presspos: { x: 0, y: 0 },
            imagepos: { x: 0, y: 0 }
        }
    },
    methods: {
        percent: function (val, total) {
            return val / total * 100 + "%";
        }
    },
    computed: {
        viewerClasses: function () {
            var that = this;
            return {
                zooming: that.viewer.mode == "zooming",
                marking: that.viewer.mode == "marking",
                pressed: that.viewer.pressed,
                mark_select: true,
                mark_place: false
            }
        },
        viewerImgStyles: function () {
            var that = this;
            return {
                left: that.viewer.imagepos.x + "px",
                top: that.viewer.imagepos.y + "px"
            }
        }
    },
    created: function () {
        var that = this;
        this.setname = window.location.query.setname;
        $.get('/api/marking/statistics?setname=' + this.setname, function(data) {
            data = data.data;
            that.statistics.marked = data.marked;
            that.statistics.total = data.total;
            status_loading(false);
        });

    }
});
$(function () {
    $(".image-wrapper img").on('mousedown', function(event) {
        event.preventDefault();
    });
    $(".image-wrapper").on('mousedown', function(event) {
        vue.viewer.pressed = true;
        console.log(event);
        vue.viewer.presspos.x = event.clientX;
    });
});
</script>
{% endblock %}
